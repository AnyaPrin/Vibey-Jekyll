<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
    <title>GitHub Post Creator</title>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-2xl">
        <h1 class="text-2xl font-bold mb-6 text-center text-gray-800">新しい投稿を作成</h1>
    
        <form id="postForm" class="space-y-4">
            <div>
                <label for="postTitle" class="block text-sm font-medium text-gray-700">タイトル</label>
                <input type="text" id="postTitle" name="postTitle" value="私の新しい投稿" required
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
    
            <div>
                <label for="postContent" class="block text-sm font-medium text-gray-700">本文</label>
                <textarea id="postContent" name="postContent" rows="10" required
                          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
ここに本文を記述します。
                </textarea>
            </div>
            
            <button type="submit"
                    class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                GitHubで開く
            </button>
        </form>
    
        <p id="statusMessage" class="mt-4 text-center text-sm font-medium text-gray-600"></p>
    </div>

    <script>
        document.getElementById('postForm').addEventListener('submit', function(event) {
            // Prevent the default form submission behavior (page reload)
            event.preventDefault();

            const owner = 'AnyaPrin';
            const repo = 'Vibey-Jekyll';
            const branch = 'main';

            // Get user input from the form
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            
            // Generate a date string and a URL-safe title
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            const safeTitle = title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '');
            const fileName = `${dateStr}-${safeTitle}.md`;

            // Create the full file content including Front Matter
            const fileContent = 
`---
layout: post
title: "${title}"
date: ${now.toISOString()}
categories: memo
---

${content}`;

            // Encode the file content to be safely included in the URL
            const encodedFileContent = encodeURIComponent(fileContent);

            // Construct the GitHub new file URL
            const newFileUrl = 
                `https://github.com/${owner}/${repo}/new/${branch}/_posts/` + 
                `?filename=${fileName}&value=${encodedFileContent}`;
            
            // Open the generated URL in a new tab
            window.open(newFileUrl, '_blank');
        });
    </script>

</body>
</html>
